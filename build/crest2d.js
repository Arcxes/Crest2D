class t{constructor(t,e){this.canvas=document.createElement("canvas"),this.canvas.id="C2DC",this.canvas.width=t,this.canvas.height=e,this.ctx=this.canvas.getContext("2d")}create(){document.body.appendChild(this.canvas),window.canvas=this.canvas,window.ctx=this.ctx}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}resize(t,e){this.canvas.width=t,this.canvas.height=e}}class e{constructor(){this.preload=null,this.create=null,this.render=null}start(t){t.setCallback(this.internalCreate()),this.preload()}registerPreLoad(t){this.preload=t}registerCreate(t){this.start=t}registerRender(t){this.render=t}internalCreate(){this.create(),requestAnimationFrame(internalRender)}internalRender(){this.render(),requestAnimationFrame(this.render)}}class s{static addClickEvent(t,e,s=!1){t.addEventListener("click",e,s),t.addEventListener("touchstart",e,s)}static removeClickEvent(t,e,s=!1){t.removeEventListener("click",e,s),t.removeEventListener("touchstart",e,s)}}class i{constructor(){this.now=0,this.delta=0,this.then=0}tick(){this.now=performance.now(),this.delta=(this.now-this.then)/1e3,this.then=this.now}getDelta(){return this.delta}}class o{constructor(){this.ctx=window.ctx}disablePixelBlending(){this.ctx.mozImageSmoothingEnabled=!1,this.ctx.msImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1}setColor(t){this.ctx.fillStyle=t}setAlpha(t){this.ctx.globalAlpha=t}setFont(t){this.ctx.font=t}setLineWidth(t){this.ctx.lineWidth=t}drawImage(t,e,s,i,o){this.ctx.drawImage(t,e,s,i,o)}drawText(t,e,s){this.ctx.fillText(t,e,s)}drawRect(t,e,s,i){this.ctx.fillRect(t,e,s,i)}drawCircle(t,e,s){ctx.beginPath(),ctx.arc(t,e,s,2*Math.PI,!1),ctx.fill()}drawStroke(t,e,s,i){core.ctx.strokeRect(t,e,s,i)}}class r{constructor(t,e,s){this.image=t,this.cols=e,this.rows=s}}class h{constructor(t,e,s){this.image=t.image,this.cols=t.cols,this.rows=t.rows,this.frameWidth=e||this.image.width/this.cols,this.frameHeight=s||this.image.height/this.rows,this.colIndex=0,this.rowIndex=0,this.ctx=window.ctx}update(t){this.colIndex+=t,this.resetModX=Math.floor(this.colIndex%this.cols)}draw(t,e,s,i){this.ctx.drawImage(this.image,this.resetModX*this.frameWidth,this.rowIndex*this.frameHeight,this.frameWidth,this.frameHeight,t,e,s,i)}setFrameRow(t){this.rowIndex=t}setFrame(t,e){this.colIndex=t,this.rowIndex=e,this.resetModX=Math.floor(this.colIndex%this.cols)}}class a{constructor(t,e,s,i){this.x=t,this.y=e,this.width=s,this.height=i,this.right=this.x+this.width,this.bottom=this.y+this.height}overlaps(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}within(t){return t.x<=this.x&&t.right>=this.right&&t.y<=this.y&&t.bottom>=this.bottom}contains(t,e){return t>=this.x&&t<=this.right&&e>=this.y&&e<=this.bottom}setPosition(t,e){this.x=t,this.y=e}setSize(t,e){this.width=t,this.height=e}}class n{constructor(t,e,s){this.x=t,this.y=e,this.radius=s}overlaps(t){return Math.sqrt((this.x-t.x)*(this.x-t.x+(this.y-t.y))*(this.y-t.y))<this.radius+t.radius}}class l{constructor(){this.left=0,this.right=0,this.top=0,this.bottom=0,this.width=0,this.height=0,this.scale={x:0,y:0},this.viewBuffer=100}}class c{constructor(t=0,e=0){this.position={x:t,y:e},this.distance=1e3,this.fov=Math.PI/4,this.viewport=new l,this.canvas=window.canvas,this.ctx=window.ctx,this.update()}begin(){this.ctx.save(),this.applyScale(),this.applyTranslation()}end(){this.ctx.restore()}applyScale(){this.ctx.scale(this.viewport.scale.x,this.viewport.scale.y)}applyTranslation(){this.ctx.translate(-this.viewport.left,-this.viewport.top)}update(){this.aspectRatio=this.canvas.width/this.canvas.height,this.viewport.width=this.distance*Math.tan(this.fov),this.viewport.height=this.viewport.width/this.aspectRatio,this.viewport.left=this.position.x-this.viewport.width/2,this.viewport.top=this.position.y-this.viewport.height/2,this.viewport.right=this.viewport.left+this.viewport.width,this.viewport.bottom=this.viewport.top+this.viewport.height,this.viewport.scale.x=this.canvas.width/this.viewport.width,this.viewport.scale.y=this.canvas.height/this.viewport.height}setZoom(t){this.distance=t,this.update()}setViewBuffer(t){this.viewport.viewBuffer=t}setPosition(t,e){this.position.x=t,this.position.y=e,this.update()}screenToWorld(t,e){let s={};return s.x=t/this.viewport.scale.x+this.viewport.left,s.y=e/this.viewport.scale.y+this.viewport.top,s}worldToScreen(t,e){let s={};return s.x=(t-this.viewport.left)*this.viewport.scale.x,s.y=(e-this.viewport.top)*this.viewport.scale.y,s}inView(t,e){return t>=this.position.x-this.viewport.viewBuffer&&t<=this.position.x+this.viewport.width+this.viewport.viewBuffer&&e>=this.position.y-this.viewport.viewBuffer&&e<=this.position.y+this.viewport.height+this.viewBuffer}}class d{load(t,e){let s=new Image;s.addEventListener("load",function(){e.successCount++,e.cache[t]=s,e.isDone()&&e.callback()}),s.addEventListener("error",function(){e.errorCount++,console.error(`Failed to load asset: { url: ${t}}`),e.isDone()&&e.callback()}),s.src=t}}class u{constructor(t,e){this.url=t,this.data=e,this.tilesets=[],this.tiles=[],this.tiles.push(null),this.image=null,this.x=0,this.y=0,this.totalTiles=0,this.folder=this.url.substring(0,this.url.lastIndexOf("/")),this.success=null,this.error=null,this.ctx=window.ctx}setCallbacks(t,e){this.success=t,this.error=e,this.loadTilesets()}loadTilesets(){let t=this,e=0,s=0;for(let i=0;i<this.data.tilesets.length;i++){let o=new Image;o.addEventListener("load",function(){e++,t.tilesets.push(o),e+s==t.data.tilesets.length&&t.seperateTiles()}),o.addEventListener("error",function(){s++,console.error("Failed to load: "+t.data.tilesets[i].image),t.error()}),this.folder.length>=1&&(this.folder+="/"),o.src=this.folder+this.data.tilesets[i].image}}seperateTiles(){let t=this;for(let e=0;e<this.tilesets.length;e++){let s=this.tilesets[e].width/this.data.tilewidth,i=this.tilesets[e].height/this.data.tileheight;this.totalTiles=s*i;for(let o=0;o<i;o++)for(let i=0;i<s;i++){let s=document.createElement("canvas"),r=s.getContext("2d");s.width=this.data.tilewidth,s.height=this.data.tileheight;let h=i*this.data.tilewidth,a=o*this.data.tileheight;r.drawImage(this.tilesets[e],-h,-a),this.tiles.push(s),this.totalTiles==t.tiles.length-1&&this.predraw()}}}predraw(){let t=document.createElement("canvas");t.width=this.data.width*this.data.tilewidth,t.height=this.data.height*this.data.tileheight;let e=t.getContext("2d");for(let t=0;t<this.data.layers.length;t++){let s=0,i=0;if("tilelayer"==this.data.layers[t].type)for(let o=0;o<this.data.layers[t].data.length;o++){if(o%this.data.width==0&&0!=o&&(i+=this.data.tileheight,s=0),0!=this.data.layers[t].data[o]){let r=this.tiles[this.data.layers[t].data[o]];e.drawImage(r,s,i)}s+=this.data.tilewidth}}let s=this;this.image=new Image,this.image.addEventListener("load",function(){s.success()}),this.image.addEventListener("error",function(){console.error("Failed to convert map canvas to image"),s.error()}),this.image.src=t.toDataURL("image/png")}render(){this.ctx.drawImage(this.image,this.x,this.y)}setPosition(t,e){this.x=t,this.y=e}}class w{load(t,e){let s=new XMLHttpRequest;s.overrideMimeType("application/json"),s.open("GET",t,!0),s.onload=function(){let i=JSON.parse(s.response);if(console.log(i),null!=i.tiledversion){let s=new u(t,i);console.log(s);let o=function(){e.successCount++,e.cache[t]=s,e.isDone()&&e.callback()},r=function(){e.errorCount++,console.error(`Failed to load asset: { url: ${t}}`),e.isDone()&&e.callback()};s.setCallbacks(o,r)}else e.successCount++,e.cache[t]=i,e.isDone()&&e.callback()},s.onerror=function(){e.errorCount++,console.error(`Failed to load asset: { url: ${t}}`),e.isDone()&&e.callback()},s.send()}}class p{static enableAudioAccess(t){try{let e=window.audioContext;if("suspended"==e.state){let s=function(){e.resume().then(function(){t.removeEventListener("touchstart",s),t.removeEventListener("touchend",s),t.removeEventListener("click",s)})};t.addEventListener("touchstart",s),t.addEventListener("touchend",s),t.addEventListener("click",s)}}catch(t){console.error(t)}}static makeSource(t,e){let s=window.audioContext,i=s.createBufferSource(),o=s.createGain();return o.gain.value=e,i.buffer=t,i.connect(o),o.connect(s.destination),i}static translateVolume(t,e){return e?100*volime:t/100}static stop(t){if(window.activeSounds.hasOwnProperty(t))for(let e in window.activeSounds[t])window.activeSounds[t].hasOwnProperty(e)&&window.activeSounds[t][e].stop()}static registerSound(t,e){window.activeSounds.hasOwnProperty(t)||(window.activeSounds[t]=[]),window.activeSounds[t].push(e)}}class g{constructor(t,e){this.url=t,this.buffer=e,this.looping=!1,this.volume=1}play(){let t=p.makeSource(this.buffer,this.volume);t.loop=this.looping,t.start(),p.registerSound(this.url,t)}stop(){p.stop(this.url)}getVolume(){return p.translateVolume(this.volume,!0)}setVolume(t){this.volume=p.translateVolume(t)}setLooping(t){this.looping=t}isLooping(){return this.looping}}class v{constructor(){this.context=window.audioContext}load(t,e){let s=new XMLHttpRequest;s.responseType="arraybuffer",s.open("GET",t,!0);let i=this;s.onload=function(){i.context.decodeAudioData(s.response,function(s){if(!s)return void console.error(`Failed to load asset: { url: ${t}}`);let i=new g(t,s);e.successCount++,e.cache[t]=i,e.isDone()&&e.callback()})},s.onerror=function(){e.errorCount++,console.error(`Failed to load asset: { url: ${t}}`),e.isDone()&&e.callback()},s.send()}}class m{constructor(){this.successCount=0,this.errorCount=0,this.totalAssets=0,this.cache={},this.queue=[],this.callback=null,this.imageLoader=new d,this.jsonLoader=new w,this.audioLoader=new v}setCallback(t){this.callback=t}add(t){this.totalAssets++,this.queue.push(t)}load(t){this.totalAssets++;let e=t.split(".");this.loadIntoMemory(t,e[1])}loadAssets(t){null!=t&&this.setCallback(t),this.isDone()&&this.callback();for(let t in this.queue){let e=this.queue[t],s=e.split(".");this.loadIntoMemory(e,s[1])}}get(t){return this.cache[t]}loadIntoMemory(t,e){"png"==e||"jpg"==e||"jpeg"==e?this.imageLoader.load(t,this):"mp3"==e||"wav"==e||"ogg"==e?this.audioLoader.load(t,this):"json"==e?this.jsonLoader.load(t,this):console.error(`Failed to load asset: { url: ${t}}`)}isDone(){return this.totalAssets==this.successCount+this.errorCount&&(this.totalAssets=0,this.queue=[],!0)}}class f{constructor(t){this.socket=null,this.parser=t}connect(t){this.socket=new WebSocket(t),this.parser.register(this.socket)}send(t){this.socket.send(this.parser.encode(t))}parse(t){return this.parser.decode(t)}set onopen(t){this.socket.onopen=t}set onmessage(t){this.socket.onmessage=t}set onerror(t){this.socket.onerror=t}set onclose(t){this.socket.onclose=t}}class x{register(t){console.log(`WebSocket: ${t} has been registered with StringParser`)}encode(t){return t}decode(t){return t}}class y{register(t){console.log(`WebSocket: ${t} has been registered with JSONParser`)}encode(t){return JSON.stringify(t)}decode(t){return JSON.parse(t)}}class b{constructor(){this.byteMultiplier=2}register(t){t.binaryType="arraybuffer",console.log(`WebSocket: ${t} has been registered with BinaryParser`)}encode(t){let e=JSON.stringify(t),s=new ArrayBuffer(e.length*this.byteMultiplier),i=new Uint16Array(s),o=e.length;for(let t=0;t<o;t++)i[t]=e.charCodeAt(t);return s}decode(t){let e=String.fromCharCode.apply(null,new Uint16Array(t));return JSON.parse(e)}}export{h as Animation,e as Application,b as BinaryParser,c as Camera,n as Circle,f as Client,i as DeltaTime,t as Display,s as InputManager,y as JSONParser,m as Loader,a as Rectangle,o as SpriteBatch,r as SpriteSheet,x as StringParser,l as Viewport};
